{%extends "base.html"%}

{%block content%}

<h3 class="m-2 text-center">{{user}}</h3>
<h5 class="m-2 text-center">{{user.points}} Points</h5>

<table class="table table-bordered calTable">

    <thead class="table-secondary">
        {%for day in days_of_week%}
        <th scope="col">{{day}}</th>
        {%endfor%}
    </thead>
    <form id="mainForm" action="/save" method="POST">
        <tbody>
            {%for day in calendar%}
            {%if day.date.weekday==0%}
            <tr class="calendar_block">
                {%endif%}
                <td id={{day.id}}>
                    <h5 class="text-center">{{day.date.strftime("%d %b")}}</h3>
                        <p class="d-none">ID: {{day.id}}</p>
                        {%if day.assigned %}
                        <h5>{{ day.assigned['last'] }}</h5>
                        {%endif%}
                        <p class="text-center">Points: {{day.value}}</p>
                        <div class="form-group row d-none">
                            Bid: <input type="text" name="{{day.id}}" id="{{day.id}}"
                                value="{% if user_bid_dict[day.id] %}
                                {{user_bid_dict[day.id]}}
                                {%else%}
                                0
                                {%endif%}
                                "></input>
                        </div>
                </td>

                {%if day.date.weekday()==6%}
            </tr>
            {%endif%}
            {%endfor%}
        </tbody>
        <div class="container-fluid">
            <div class="row">
                <div class="text-center col-3">
                    <button class="m-3 btn btn-primary" id="submit" type="submit">Save Preferences</button>

                </div>
                <div class="d-block col-6">
                        <h1 class="text-center"><a href="/calendar/{{start_info.first_dom.year}}/{{start_info.first_dom.month-1}}">&lt</a>
                        {{start_info.first_dom.strftime("%B %Y")}}
                        <a href="/calendar/{{start_info.first_dom.year}}/{{start_info.first_dom.month+1}}">&gt</a></h1>
                </div>
                <div class="text-center col-3">
                    <button class="m-3 btn btn-warning" id="reset">Reset Calendar</button>
                </div>
            </div>
        </div>
    </form>
</table>

<script>


    function colorCells() {
        $(this).removeClass();
        if ($(this).children().children("input").val() == 0) {
            $(this).addClass("bg-danger");
        }
        else if ($(this).children().children("input").val() == 1) {
        }
        else if ($(this).children().children("input").val() == 2) {
            $(this).addClass("bg-success");
        }
        else if ($(this).children().children("input").val() > 2) {
            $(this).children().children("input").val(0);
            $(this).addClass("bg-danger");
        }
    }

    function increment() {
        $(this).children().children("input").val(parseInt($(this).children().children("input").val()) + 1);
    }

    function reset() {
        $(this).children().children("input").val(1);
    }

    $(document).ready(function () {
        $("td").each(colorCells);
        // $('.d-none').removeClass("d-none")
    });

    $("td").click(increment);
    $("td").click(colorCells);
    $('#reset').click(function () {
        $("td").each(reset)
    });

    $(document).keypress(function (e) {
        if (e.which == 13) {
            $("#submit").click();
        }
    });

</script>

{%endblock%}